file.remove("Documentation for the State Health Expenditure Data Files_Residence.docx")
list.of.packages <-
c("tidyverse","survey","tidycensus","foreach", "dplyr",)
list.of.packages <-
c("tidyverse","survey","tidycensus","foreach","dplyr")
new.packages <-
list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages))
install.packages(new.packages, repos = "http://cran.rstudio.com/")
lapply(list.of.packages, library, character.only = TRUE)
census_api_key("2e8d2ae236293d177891032824a43d16560b3bcf")
# list of state abbreviations plus DC
states = c(state.abb, "DC")
# define variables that exist for all years of data in years container
vars <- c(
pub_ins_25 = "B27015_005",
pub_ins_50 = "B27015_010",
pub_ins_75 = "B27015_015",
pub_ins_100 = "B27015_020",
pub_ins_top = "B27015_025"
)
states
vars
geography <- "state"
acs =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=year,
geometry=FALSE,
survey="acs1")
}
states
vars
year
acs =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year="2016",
geometry=FALSE,
survey="acs1")
}
View(acs)
sum(acs$estimate)
states
state_fips =
c("1","2","4","5","6","8","9","10","11","12","13","15","16","17","18",
"19","20","21","22","23","24","25","26","27","28","29","30","31","32","33",
"34","35","36","37","38","39","40","41","42","44","45","46","47","48","49",
"50","51","53","54","55","56","0")
state_abbr =
c("AL","AK","AZ","AR","CA","CO","CT","DE","DC","FL","GA","HI","ID","IL","IN",
"IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH",
"NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT",
"VT","VA","WA","WV","WI","WY","US")
statemap = data.frame(fips = state_fips, state = state_abbr)
statemap
?left_join
acs = acs %>% left_join(statemap, by=c("GEOID"="fips"))
head(acs)
head(statemap)
state_fips =
c("01","02","04","05","06","08","09","10","11","12","13","15","16","17","18",
"19","20","21","22","23","24","25","26","27","28","29","30","31","32","33",
"34","35","36","37","38","39","40","41","42","44","45","46","47","48","49",
"50","51","53","54","55","56","00")
state_abbr =
c("AL","AK","AZ","AR","CA","CO","CT","DE","DC","FL","GA","HI","ID","IL","IN",
"IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH",
"NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT",
"VT","VA","WA","WV","WI","WY","US")
statemap = data.frame(fips = state_fips, state = state_abbr)
acs$state=NULL
head(acs)
acs = acs %>% select(-moe)
statemap = data.frame(fips = state_fips, state = state_abbr)
acs = acs %>% left_join(statemap, by=c("GEOID"="fips"))
head(acs)
acs = acs %>% select(state,variable,estimate) %>%
pivot_wider(names_from=variable, values_from=estimate)
head(acs)
acs = acs %>%
mutate(total = pub_ins_25 + pub_ins_50 + pub_ins_75 + pub_ins_100 + pub_ins_top,
pub_ins_25 = pub_ins_25/total,
pub_ins_50 = pub_ins_50/total,
pub_ins_75 = pub_ins_75/total,
pub_ins_100 = pub_ins_100/total,
pub_ins_top = pub_ins_top/total)
acs = acs %>%  select(-total)
head(acs)
acs = acs %>% pivot_longer(names_to="income", values_to="pub_ins_shares")
?pivot_longer
acs = acs %>% pivot_longer(-state, names_to="income", values_to="pub_ins_shares")
head(acs)
acs$income[acs$income=="pub_ins_25"] = "<25k"
acs$income[acs$income=="pub_ins_50"] = "25-50k"
acs$income[acs$income=="pub_ins_75"] = "50-75k"
acs$income[acs$income=="pub_ins_100"] = "75-100k"
acs$income[acs$income=="pub_ins_top"] = ">100k"
head(acs)
head(medicare_total)
unique(medicare_total$Region_Number)
medicare_total = medicare_total >%>
medicare_total = medicare_total %>%
select(-Code,-Item, -Average_Annual_Percent_Growth) %>%
pivot_longer(-c(Group,Region_Number,Region_Name,State_Name), names_to="year", values_to="medicare")
head(medicare_total)
unique(medicare_total$State_Name)
medicare_total = medicare_total %>%
filter(!(State_Name %in% ""))
head(medicare_total)
medicare_total = medicare_total %>% select(State_Name,year,medicare)
head(medicare_total)
medicaid_total = medicaid_total %>%
select(-Code,-Item, -Average_Annual_Percent_Growth) %>%
pivot_longer(-c(Group,Region_Number,Region_Name,State_Name), names_to="year", values_to="medicaid") %>%
filter(!(State_Name %in% "")) %>%
select(State_Name,year,medicaid)
head(medicaid_total)
cms = left_join(medicare,medicaid)
cms = left_join(medicare_total,medicaid_total)
head(cms)
View(medicare_total)
url = "https://www.cms.gov/research-statistics-data-and-systems/statistics-trends-and-reports/nationalhealthexpenddata/downloads/"
file.name = "resident-state-estimates.zip"
download_file(url,paste0(file.name),dir=data.dir)
medicare_total = read.csv("MEDICARE_AGGREGATE20.CSV")
View(medicare_total)
chk = read.csv("MEDICARE_AGGREGATE20.CSV") %>%
filter(Region_Name %in% "United States")
View(chk)
sum(chk$Y1991)/2
medicare_total = read.csv("MEDICARE_AGGREGATE20.CSV") %>%
select(-Code,-Item, -Average_Annual_Percent_Growth) %>%
filter(Group %in% 1) %>%
pivot_longer(-c(Group,Region_Number,Region_Name,State_Name), names_to="year", values_to="medicare") %>%
filter(!(State_Name %in% "")) %>%
select(State_Name,year,medicare)
medicaid_total = read.csv("MEDICAID_AGGREGATE20.CSV") %>%
select(-Code,-Item, -Average_Annual_Percent_Growth) %>%
filter(Group %in% 1) %>%
pivot_longer(-c(Group,Region_Number,Region_Name,State_Name), names_to="year", values_to="medicaid") %>%
filter(!(State_Name %in% "")) %>%
select(State_Name,year,medicaid)
medicare_total = read.csv("MEDICARE_AGGREGATE20.CSV") %>%
select(-Code,-Item, -Average_Annual_Percent_Growth) %>%
filter(Group %in% 1) %>%
pivot_longer(-c(Group,Region_Number,Region_Name,State_Name), names_to="year", values_to="medicare") %>%
filter(!(State_Name %in% "")) %>%
select(State_Name,year,medicare)
medicare_numenr = read.csv("MEDICARE_ENROLLMENT20.CSV")
medicare_percap = read.csv("MEDICARE_PER_ENROLLEE20.CSV")
medicaid_total = read.csv("MEDICAID_AGGREGATE20.CSV") %>%
select(-Code,-Item, -Average_Annual_Percent_Growth) %>%
filter(Group %in% 1) %>%
pivot_longer(-c(Group,Region_Number,Region_Name,State_Name), names_to="year", values_to="medicaid") %>%
filter(!(State_Name %in% "")) %>%
select(State_Name,year,medicaid)
medicaid_numenr = read.csv("MEDICAID_ENROLLMENT20.CSV")
medicaid_percap = read.csv("MEDICAID_PER_ENROLLEE20.CSV")
downloaded_files = list.files(pattern="\\.CSV$")
file.remove(downloaded_files)
file.remove("Documentation for the State Health Expenditure Data Files_Residence.docx")
# add medicaid and medicare together
cms = left_join(medicare_total,medicaid_total)
head(cms)
head(medicare_total)
url = "https://www.cms.gov/research-statistics-data-and-systems/statistics-trends-and-reports/nationalhealthexpenddata/downloads/"
file.name = "resident-state-estimates.zip"
download_file(url,paste0(file.name),dir=data.dir)
# use totals (Group = 1)
medicare_total = read.csv("MEDICARE_AGGREGATE20.CSV") %>%
select(-Code,-Item, -Average_Annual_Percent_Growth) %>%
filter(Group==1) %>%
pivot_longer(-c(Group,Region_Number,Region_Name,State_Name), names_to="year", values_to="medicare") %>%
filter(!(State_Name %in% "")) %>%
select(State_Name,year,medicare)
medicare_numenr = read.csv("MEDICARE_ENROLLMENT20.CSV")
medicare_percap = read.csv("MEDICARE_PER_ENROLLEE20.CSV")
medicaid_total = read.csv("MEDICAID_AGGREGATE20.CSV") %>%
select(-Code,-Item, -Average_Annual_Percent_Growth) %>%
filter(Group==1) %>%
pivot_longer(-c(Group,Region_Number,Region_Name,State_Name), names_to="year", values_to="medicaid") %>%
filter(!(State_Name %in% "")) %>%
select(State_Name,year,medicaid)
medicaid_numenr = read.csv("MEDICAID_ENROLLMENT20.CSV")
medicaid_percap = read.csv("MEDICAID_PER_ENROLLEE20.CSV")
# delete unzipped files
downloaded_files = list.files(pattern="\\.CSV$")
file.remove(downloaded_files)
file.remove("Documentation for the State Health Expenditure Data Files_Residence.docx")
# add medicaid and medicare together
cms = left_join(medicare_total,medicaid_total)
head(cms)
url = "https://www.cms.gov/research-statistics-data-and-systems/statistics-trends-and-reports/nationalhealthexpenddata/downloads/"
file.name = "resident-state-estimates.zip"
download_file(url,paste0(file.name),dir=data.dir)
# use totals (Group = 1)
medicare_total = read.csv("MEDICARE_AGGREGATE20.CSV") %>%
select(-Code,-Item, -Average_Annual_Percent_Growth) %>%
filter(Group==1) %>%
pivot_longer(-c(Group,Region_Number,Region_Name,State_Name), names_to="year", values_to="medicare") %>%
filter(!(State_Name %in% "")) %>%
select(State_Name,year,medicare)
head(medicare_total)
medicare_total = read.csv("MEDICARE_AGGREGATE20.CSV") %>%
select(-Code,-Item, -Average_Annual_Percent_Growth) %>%
filter(Group %in% 1) %>%
pivot_longer(-c(Group,Region_Number,Region_Name,State_Name), names_to="year", values_to="medicare") %>%
filter(!(State_Name %in% "")) %>%
select(State_Name,year,medicare)
head(medicare_total)
medicare_total = read.csv("MEDICARE_AGGREGATE20.CSV") %>%
select(-Code,-Item, -Average_Annual_Percent_Growth
)
head(medicare_total)
medicare_total = read.csv("MEDICARE_AGGREGATE20.CSV") %>%
select(-Item, -Average_Annual_Percent_Growth) %>%
filter(Code %in% 1) %>%
pivot_longer(-c(Code,Group,Region_Number,Region_Name,State_Name), names_to="year", values_to="medicare") %>%
filter(!(State_Name %in% "")) %>%
select(State_Name,year,medicare)
head(medicare_total)
medicare_numenr = read.csv("MEDICARE_ENROLLMENT20.CSV")
medicare_percap = read.csv("MEDICARE_PER_ENROLLEE20.CSV")
medicaid_total = read.csv("MEDICAID_AGGREGATE20.CSV") %>%
select(-Item, -Average_Annual_Percent_Growth) %>%
filter(Code %in% 1) %>%
pivot_longer(-c(Code,Group,Region_Number,Region_Name,State_Name), names_to="year", values_to="medicaid") %>%
filter(!(State_Name %in% "")) %>%
select(State_Name,year,medicaid)
medicaid_numenr = read.csv("MEDICAID_ENROLLMENT20.CSV")
medicaid_percap = read.csv("MEDICAID_PER_ENROLLEE20.CSV")
# delete unzipped files
downloaded_files = list.files(pattern="\\.CSV$")
file.remove(downloaded_files)
file.remove("Documentation for the State Health Expenditure Data Files_Residence.docx")
# add medicaid and medicare together
cms = left_join(medicare_total,medicaid_total)
head(cms)
View(cms)
cms = left_join(medicare_total,medicaid_total) %>%
mutate(year = as.numeric(year))
head(cms)
?str_replace
cms = left_join(medicare_total,medicaid_total) %>%
mutate(year = as.numeric(str_rep(year,"Y","")))
cms = left_join(medicare_total,medicaid_total) %>%
mutate(year = as.numeric(str_replace(year,"Y","")))
head(cms)
cms = left_join(medicare_total,medicaid_total) %>%
mutate(year = as.numeric(str_replace(year,"Y",""))) %>%
filter(year >= 2000)
years = c(1997*2021)
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=year,
geometry=FALSE,
survey="acs1")
}
years = c(1997*2021)
head(years)
years = c(1997:2021)
head(years)
for (i in 1:length(years)) {
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=year,
geometry=FALSE,
survey="acs1")
}
acs = rbind(acs,acs_loop)
}
i = 2000
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=i,
geometry=FALSE,
survey="acs1")
}
i = 2005
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=i,
geometry=FALSE,
survey="acs1")
}
i = 2006
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=i,
geometry=FALSE,
survey="acs1")
}
y = 2005
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=y,
geometry=FALSE,
survey="acs1")
}
vars
y = 2006
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=y,
geometry=FALSE,
survey="acs1")
}
y = 2016
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=y,
geometry=FALSE,
survey="acs1")
}
y = 2010
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=y,
geometry=FALSE,
survey="acs1")
}
y = 2009
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=y,
geometry=FALSE,
survey="acs1")
}
y = 2008
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=y,
geometry=FALSE,
survey="acs1")
}
acs = data.frame()
geography <- "state"
years = c(2009:2021)
acs = data.frame()
for (y in 1:length(years)) {
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=y,
geometry=FALSE,
survey="acs1")
}
acs = rbind(acs,acs_loop)
}
geography <- "state"
years = c(2009:2021)
acs = data.frame()
for (y in years) {
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=y,
geometry=FALSE,
survey="acs1")
}
acs = rbind(acs,acs_loop)
}
head(acs)
geography <- "state"
years = c(2009:2019)
acs = data.frame()
geography <- "state"
years = c(2009:2019,2021)
acs = data.frame()
for (y in years) {
acs_loop =
foreach (i=1:length(states), .combine=rbind,
.packages=c("tidycensus", "tidyverse")) %do% {
print(paste("starting state:", states[i]))
get_acs(geography=geography,
state=states[i],
variables=vars,
year=y,
geometry=FALSE,
survey="acs1")
}
acs_loop$year = y
acs = rbind(acs,acs_loop)
}
head(acs)
acs = acs %>% select(-moe)
state_fips =
c("01","02","04","05","06","08","09","10","11","12","13","15","16","17","18",
"19","20","21","22","23","24","25","26","27","28","29","30","31","32","33",
"34","35","36","37","38","39","40","41","42","44","45","46","47","48","49",
"50","51","53","54","55","56","00")
state_abbr =
c("AL","AK","AZ","AR","CA","CO","CT","DE","DC","FL","GA","HI","ID","IL","IN",
"IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH",
"NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT",
"VT","VA","WA","WV","WI","WY","US")
statemap = data.frame(fips = state_fips, state = state_abbr)
acs = acs %>% left_join(statemap, by=c("GEOID"="fips"))
head(acs)
acs = acs %>% select(NAME,state,year,variable,estimate) %>%
pivot_wider(names_from=variable, values_from=estimate) %>%
mutate(total = pub_ins_25 + pub_ins_50 + pub_ins_75 + pub_ins_100 + pub_ins_top,
pub_ins_25 = pub_ins_25/total,
pub_ins_50 = pub_ins_50/total,
pub_ins_75 = pub_ins_75/total,
pub_ins_100 = pub_ins_100/total,
pub_ins_top = pub_ins_top/total) %>%
select(-total)
head(acs)
acs = acs %>%
pivot_longer(-c(NAME,state,year), names_to="income", values_to="pub_ins_shares")
acs$income[acs$income=="pub_ins_25"] = "<25k"
acs$income[acs$income=="pub_ins_50"] = "25-50k"
acs$income[acs$income=="pub_ins_75"] = "50-75k"
acs$income[acs$income=="pub_ins_100"] = "75-100k"
acs$income[acs$income=="pub_ins_top"] = ">100k"
head(acs)
head(medicare_total)
head(cms)
acs = acs %>%
left_join(cms,by=c("NAME"="State_Name", "year"="year"))
head(acs)
acs = acs %>%
mutate(medicare = 1e-3 * pub_ins_shares*medicare,
medicaid = 1e-3 * pub_ins_shares*medicaid)
head(acs)
acs = acs %>%
select(-NAME,-pub_ins_shares)
head(acs)
chktotals = acs %>%
group_by(year) %>%
summarize(medicare = sum(medicare),
medicaid = sum(medicaid))
View(chktotals)
write.csv(acs, paste0("public_health_benefits_",min(years),"_",max(years),".csv"), row.names=FALSE)
years = c(2009:2019)
acs = acs %>% filter(year < 2021)
head(acs)
unique(acs$year)
write.csv(acs, paste0("public_health_benefits_",min(years),"_",max(years),".csv"), row.names=FALSE)
